# =============================================================================
# LMS Backend Environment Configuration
# Copy this file to .env and fill in your values
# =============================================================================

# =============================================================================
# CRITICAL SECURITY SETTINGS (REQUIRED IN PRODUCTION)
# =============================================================================

# JWT Secret - REQUIRED in production (minimum 32 characters, randomly generated)
# Generate with: node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
JWT_SECRET=your-secure-random-secret-minimum-32-characters

# Cookie Secret - REQUIRED in production (for signed cookies)
# Generate with: node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
COOKIE_SECRET=your-secure-cookie-secret-minimum-32-characters

# JWT Token Expiry (default: 7d)
JWT_EXPIRY=7d

# Cookie SameSite policy (default: lax)
# Options: strict | lax | none
# Use 'lax' for same-domain deployments (recommended)
# Use 'none' for cross-origin deployments (frontend on different domain/subdomain)
# Note: 'none' requires HTTPS (Secure flag is auto-enabled)
COOKIE_SAMESITE=lax

# =============================================================================
# Azure Storage Configuration
# =============================================================================

# Azure Storage Account Name
AZURE_STORAGE_ACCOUNT_NAME=your-storage-account-name

# Azure Storage Account Key
AZURE_STORAGE_ACCOUNT_KEY=your-storage-account-key

# Azure Blob Container Name (default: lms-content)
AZURE_STORAGE_CONTAINER_NAME=lms-content

# Optional: Custom Table Storage endpoint
# AZURE_STORAGE_TABLE_ENDPOINT=https://your-account.table.core.windows.net

# =============================================================================
# Default Admin Configuration
# =============================================================================

# Default admin email (default: admin@example.com)
DEFAULT_ADMIN_EMAIL=admin@yourcompany.com

# Default admin password - REQUIRED in production
# Set this to create an initial admin user on first startup
DEFAULT_ADMIN_PASSWORD=your-secure-admin-password

# Default admin name (default: Admin User)
DEFAULT_ADMIN_NAME=System Administrator

# =============================================================================
# Server Configuration
# =============================================================================

# Server port (default: 3001)
PORT=3001

# Host to bind to (default: 0.0.0.0 for all interfaces)
HOST=0.0.0.0

# Base URL for the server (auto-detected if not set)
# Set this for Azure or custom deployments
# BASE_URL=https://your-lms.azurewebsites.net

# Node environment (development | production)
NODE_ENV=development

# =============================================================================
# CORS Configuration (Production)
# =============================================================================

# Comma-separated list of allowed origins
# In development, all origins are allowed
# In production, only these origins can make requests
# CORS_ORIGINS=https://your-lms.azurewebsites.net,https://your-custom-domain.com

# =============================================================================
# Logging Configuration
# =============================================================================

# Log level: trace, debug, info, warn, error, fatal
LOG_LEVEL=info

# =============================================================================
# Rate Limiting (defaults shown - configured in code)
# =============================================================================

# Auth endpoint: 100 requests per 15 minutes
# API endpoint: 300 requests per minute  
# xAPI endpoint: 500 requests per minute

# =============================================================================
# Security Configuration
# =============================================================================

# Password complexity (default: true)
# Set to 'false' to disable complexity requirements (dev only!)
REQUIRE_PASSWORD_COMPLEXITY=true

# Account lockout settings
MAX_FAILED_ATTEMPTS=5
LOCKOUT_DURATION_MINUTES=15

# =============================================================================
# Performance Configuration
# =============================================================================

# Verb statistics cache size (LRU eviction when exceeded)
VERB_CACHE_MAX_SIZE=10000

# Progress sync limits
MAX_STATEMENTS_PER_SYNC=5000
MAX_GAP_SECONDS=300
DEFAULT_STATEMENTS_PER_COURSE=80

# Pagination limit for admin endpoints
MAX_PROGRESS_PAGE_SIZE=1000

# Graceful shutdown timeout (milliseconds)
SHUTDOWN_TIMEOUT_MS=10000

# =============================================================================
# Content Security Policy (CSP)
# =============================================================================

# Additional connect-src origins for CSP (e.g., external APIs)
# CSP_CONNECT_SRC=https://api.example.com

# =============================================================================
# PRODUCTION DEPLOYMENT CHECKLIST
# =============================================================================
# 
# Before deploying to production, ensure:
#
# 1. ✅ JWT_SECRET is set to a strong random value (64+ chars)
# 2. ✅ COOKIE_SECRET is set to a strong random value (32+ chars)
# 3. ✅ DEFAULT_ADMIN_PASSWORD is set to a strong password
# 4. ✅ NODE_ENV=production
# 5. ✅ CORS_ORIGINS includes your domain(s)
# 6. ✅ HTTPS is enabled (Azure handles this automatically)
# 7. ✅ Azure Storage credentials are secure (use Azure Key Vault ideally)
#
# Security features enabled in production:
# - httpOnly cookies for auth tokens (XSS protection)
# - CSRF protection for state-changing requests
# - HTTPS enforcement
# - Secure cookie attributes (Secure, SameSite=Strict)
# - Rate limiting on all endpoints
# - Request ID tracking for audit logs
